{"mappings":"oeAAA,IAAAA,EAAAC,EAAA,6DAOA,IAAIC,EAEAC,EADAC,GAAS,EAGb,MAAMC,EAAoBC,SAASC,eAAe,qBA6ClDC,eAAeC,IAGX,GAFAN,EARJ,SAAkBO,GACd,MAAMC,EAAMC,OAAOC,SAASC,OAG5B,OAFqB,IAAIC,gBAAgBJ,GACjBK,IAAIN,GAKhBO,CAAS,MAElBd,EAAW,CACVC,GAAS,GAcjB,SAAqBc,GACjBb,EAAkBc,KAAKC,MAAQF,EAAQC,KACvCd,EAAkBgB,YAAYD,MAAQF,EAAQG,YAC9ChB,EAAkBiB,MAAMF,MAAQF,EAAQI,MACxCjB,EAAkBkB,SAASH,MAAQF,EAAQK,SATvCC,CALgB,UAFGC,EAAAC,WAAWvB,GAI1BwB,GAAIxB,KArDhBE,EAAkBuB,iBAAiB,UAAUpB,MAAOqB,IAChDA,EAAEC,iBACFC,QAAQC,IAAI,wBAEZ,MAAMb,EAAOd,EAAkBc,KAAKC,MAC9BC,EAAchB,EAAkBgB,YAAYD,MAC5CE,EAAQjB,EAAkBiB,MAAMF,MAChCG,EAAWlB,EAAkBkB,SAASH,MACtCa,EAAS5B,EAAkB4B,OAAOC,MAExC,IAAIC,EAAU,GAEd,GAAIF,EAAOG,OAAQ,CAEf,MAAMC,QAAuBC,EAAAC,aAAavC,EAAAwC,QAAS,IAAIP,IAEvDE,QAAgBM,QAAQC,IAAIL,GAGhC,MAAMM,EAAa,MACfxB,cACAE,QACAC,WACAC,EACAU,OAAQE,GAGZJ,QAAQC,IAAIW,GACTvC,QACOkC,EAAAM,YAAY5C,EAAA6C,GAAGF,EAAWxC,SAE1BmC,EAAAQ,WAAW9C,EAAA6C,GAAIF,MAuC7BI,EAAAC,mBAAmBhD,EAAAiD,MAAMzC,MAAO0C,IACxBA,GAGFC,EAAAC,QAAQF,EAAKG,KAAKC,MAAKC,IACrBrD,EAAaqD,EACVrD,EAAWsD,QACV/C,IAEAG,OAAOC,SAAS4C,KAAO","sources":["scripts/createProduct.js"],"sourcesContent":["import { storage, db, auth } from \"./app\";\r\nimport { onAuthStateChanged } from \"firebase/auth\";\r\nimport { getProduct } from \"./getProducts\";\r\nimport { addProduct, uploadImages, editProduct } from \"./addProduct\";\r\nimport { getUser } from \"./getUser\";\r\n\r\n\r\nlet userLogged = undefined;\r\nlet isEdit = false;\r\nlet productId = undefined;\r\n\r\nconst createProductForm = document.getElementById(\"createProductForm\");\r\n\r\ncreateProductForm.addEventListener(\"submit\", async (e) => {\r\n    e.preventDefault();\r\n    console.log(\"Create a new product\");\r\n\r\n    const name = createProductForm.name.value;\r\n    const description = createProductForm.description.value;\r\n    const price = createProductForm.price.value;\r\n    const category = createProductForm.category.value;\r\n    const images = createProductForm.images.files;\r\n\r\n    let gallery = [];\r\n\r\n    if (images.length) {\r\n        // Vamos a subir las imagenes a firestore\r\n        const uploadedImages = await uploadImages(storage, [...images]);\r\n\r\n        gallery = await Promise.all(uploadedImages);\r\n    }\r\n\r\n    const newProduct = {\r\n        name,\r\n        description,\r\n        price,\r\n        category,\r\n        images: gallery,\r\n    };\r\n\r\n    console.log(newProduct);\r\n    if(isEdit){\r\n        await editProduct(db,newProduct,productId);\r\n    } else {\r\n        await addProduct(db, newProduct);\r\n    }\r\n    \r\n});\r\n\r\nfunction getParam(param) {\r\n    const url = window.location.search;\r\n    const searchParams = new URLSearchParams(url);\r\n    const Id = searchParams.get(param);\r\n    return Id;\r\n}\r\n\r\nasync function loadProductEdit() {\r\n    productId = getParam(\"id\");\r\n\r\n    if(productId) {\r\n        isEdit = true;\r\n\r\n        const data = await getProduct(productId);\r\n\r\n        const product = {\r\n            ...data,\r\n            id: productId\r\n        }\r\n    \r\n        seeFeatures(product)\r\n    }\r\n\r\n}\r\n\r\nfunction seeFeatures(product) {\r\n    createProductForm.name.value = product.name;\r\n    createProductForm.description.value = product.description;\r\n    createProductForm.price.value = product.price;\r\n    createProductForm.category.value = product.category;\r\n    \r\n}\r\n\r\n\r\nonAuthStateChanged(auth, async (user) => {\r\n    if (user) {\r\n      // User is signed in, see docs for a list of available properties\r\n      // https://firebase.google.com/docs/reference/js/firebase.User\r\n      getUser(user.uid).then(user=>{\r\n        userLogged = user;\r\n        if(userLogged.isAdmin){\r\n            loadProductEdit();\r\n        } else {\r\n            window.location.href = \"shop.html\";\r\n        }\r\n        \r\n    });\r\n\r\n      // ...\r\n    } else {\r\n        \r\n      // User is signed out\r\n      // ...\r\n    }\r\n\r\n  });"],"names":["$2mFfu","parcelRequire","$6f9802a7e8fd514c$var$userLogged","$6f9802a7e8fd514c$var$productId","$6f9802a7e8fd514c$var$isEdit","$6f9802a7e8fd514c$var$createProductForm","document","getElementById","async","$6f9802a7e8fd514c$var$loadProductEdit","param","url","window","location","search","URLSearchParams","get","$6f9802a7e8fd514c$var$getParam","product","name","value","description","price","category","$6f9802a7e8fd514c$var$seeFeatures","$dKLxC","getProduct","id","addEventListener","e","preventDefault","console","log","images","files","gallery","length","uploadedImages","$aWEll","uploadImages","storage","Promise","all","newProduct","editProduct","db","addProduct","$1tHc5","onAuthStateChanged","auth","user1","$3iQ2G","getUser","uid","then","user","isAdmin","href"],"version":3,"file":"createProduct.50cb08e3.js.map"}