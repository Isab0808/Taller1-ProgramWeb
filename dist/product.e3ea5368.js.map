{"mappings":"oeAAA,IAAAA,EAAAC,EAAA,6DAMA,MAAMC,EAAqBC,SAASC,eAAe,eAC7CC,EAAuBF,SAASC,eAAe,iBAErD,IAAIE,EACAC,EAAO,GASXC,eAAeC,IACX,MAAMC,EARV,SAAkBC,GACd,MAAMC,EAAMC,OAAOC,SAASC,OAG5B,OAFqB,IAAIC,gBAAgBJ,GACVK,IAAIN,GAKjBO,CAAS,OAY/B,SAAuBC,GACnB,IAAIC,EAAS,EACTC,EAAYlB,SAASmB,cAAc,OACnCH,EAAQI,OAAOC,OAAS,GACxBC,EAAcN,EAAQI,OAAOF,GAIjCA,EAAUK,IAAMP,EAAQI,OAAO,GAC/BF,EAAUM,UAAY,qBACtBN,EAAUO,GAAK,YACfvB,EAAqBwB,YAAYR,GAEjC,MAEMS,EAFuBvB,EAAKwB,MAAMC,GAAgBA,EAAYJ,KAAOT,EAAQS,KAG/E,mEAAkE,2DAGrE1B,EAAkB+B,UAAY,mCAaLd,EAASe,6CACjBf,EAAiBgB,gDAC/BhB,EAAUiB,8CAEVC,EAAAC,eAAqBnB,EAAEoB,oDAEnBpB,EACAqB,0HAKLrB,EAAAe,+BAAAd,4EAMHU,IACA,MAAAW,EAAoBtC,SAAAuC,cAAmB,kBACvCD,EAAgBE,iBACL,SAAaC,IAChBrC,EAAsBsC,KAAU1B,GACjCkB,EAAAS,iBAAAvC,GAIPD,GAAoByC,EAACC,mBAAqBhD,EAAAiD,GAAA3C,EAAA4C,IAAA3C,GAE1CkC,EAAsBU,aAAS,YAAc,GAE7CV,EAAcW,UAAiB,sBAlE/BC,CALgB,UAFGC,EAAAC,WAAW7C,GAI1BkB,GAAIlB,aA0EXe,EAAAF,EAAAiC,GAED,MAAAC,EAAAtD,SAAAmB,cAAA,OACImC,EAAQ9B,UAAE,mBACNJ,EAAAC,OAAA,GAAAD,EAAAmC,SAAAC,IACAF,EAAAxB,WAAA,aAAA0B,WAEa9B,YAAA4B,GACDtD,SAAAuC,cAAM,qBACZC,iBAAA,SAAAC,IAEN,QAAAA,EAAAgB,OAAAC,SAAOxC,UAAA8B,aAAA,MAAAP,EAAAgB,OAAAE","sources":["scripts/product.js"],"sourcesContent":["import { db, auth } from \"./app\";\r\nimport { onAuthStateChanged } from \"firebase/auth\";\r\nimport { getProduct } from \"./getProducts\";\r\nimport { getFirebaseCart, createFirebaseCart } from \"./cart\";\r\nimport { getMyLocalCart, addProductToCart, currencyFormat } from \"./utils\";\r\n\r\nconst productInfoSection = document.getElementById(\"productInfo\");\r\nconst productAssetsSection = document.getElementById(\"productAssets\");\r\n\r\nlet userLogged = undefined;\r\nlet cart = [];\r\n\r\nfunction getParam(param) {\r\n    const url = window.location.search;\r\n    const searchParams = new URLSearchParams(url);\r\n    const productId = searchParams.get(param);\r\n    return productId;\r\n}\r\n\r\nasync function loadProduct() {\r\n    const productId = getParam(\"id\"); // http://localhost:1234/product.html?id=TXQ9Wf1GIoAOJLkIEMYo&age=20\r\n\r\n    const data = await getProduct(productId);\r\n\r\n    const product = {\r\n        ...data,\r\n        id: productId, // docSnap.id,\r\n    }\r\n\r\n    renderProduct(product);\r\n}\r\n\r\nfunction renderProduct(product) {\r\n    let amount = 0;\r\n    let mainImage = document.createElement('img');\r\n    if (product.images.length > 0) {\r\n        createGallery(product.images,mainImage);\r\n    }\r\n    \r\n    \r\n    mainImage.src = product.images[0];\r\n    mainImage.className = 'product__mainImage';\r\n    mainImage.id = \"mainImage\";\r\n    productAssetsSection.appendChild(mainImage);\r\n\r\n    const isProductAddedToCart = cart.some((productCart) => productCart.id === product.id);\r\n\r\n    const productButtonCart = isProductAddedToCart ?\r\n        '<button class=\"product__cart\" disabled>Producto añadido</button>' :\r\n        '<button class=\"product__cart\">Añadir al carrito</button>';\r\n\r\n    productInfoSection.innerHTML = `\r\n    <h1 class=\"product__name\">${product.name}</h1>\r\n    <p class=\"product__review\">${product.category}</p>\r\n    <p class=\"product__review\">${product.review}</p>\r\n    <h3 class=\"product__price\">${currencyFormat(product.price)}</h3>\r\n    <p class=\"product__description\">${product.description}</p>\r\n        <div class=\"counter\">\r\n        <button class=\"remove__item\"><</button>\r\n        <p id=\"amount_${product.name}\" class=\"counter__text\">${amount}</p>\r\n        <button class=\"add__item\">></button>\r\n        </div>\r\n    ${productButtonCart}`;\r\n\r\n    const productCartButton = document.querySelector(\".product__cart\");\r\n    productCartButton.addEventListener(\"click\", e => {\r\n        cart.push(product);\r\n\r\n        addProductToCart(cart);\r\n\r\n        if (userLogged) {\r\n            createFirebaseCart(db, userLogged.uid, cart);\r\n        }\r\n\r\n        productCartButton.setAttribute(\"disabled\", true);\r\n        productCartButton.innerText = \"Producto añadido\";\r\n    });\r\n}\r\n\r\nfunction createGallery(images,main) {\r\n    \r\n\r\n    const gallery = document.createElement(\"div\");\r\n    gallery.className = \"product__gallery\";\r\n    if(images.length > 1){\r\n        images.forEach(image => {\r\n            gallery.innerHTML += `<img src=\"${image}\">`;\r\n        });\r\n    } \r\n\r\n\r\n    productAssetsSection.appendChild(gallery);\r\n\r\n    const galleryImages = document.querySelector(\".product__gallery\");\r\n\r\n    galleryImages.addEventListener(\"click\", e => {\r\n        if (e.target.tagName === \"IMG\") {\r\n            mainImage.setAttribute(\"src\", e.target.currentSrc);\r\n        }\r\n    });\r\n}\r\n\r\nonAuthStateChanged(auth, async (user) => {\r\n    if (user) {\r\n        // User is signed in, see docs for a list of available properties\r\n        // https://firebase.google.com/docs/reference/js/firebase.User\r\n        userLogged = user;\r\n        cart = await getFirebaseCart(db, userLogged.uid);\r\n        console.log(cart);\r\n        // ...\r\n    } else {\r\n        cart = getMyLocalCart();\r\n        // User is signed out\r\n        // ...\r\n    }\r\n\r\n    loadProduct();\r\n\r\n});"],"names":["$2mFfu","parcelRequire","$efff59cb340ffb8f$var$productInfoSection","document","getElementById","$efff59cb340ffb8f$var$productAssetsSection","$efff59cb340ffb8f$var$userLogged","$efff59cb340ffb8f$var$cart","async","$efff59cb340ffb8f$var$loadProduct","productId","param","url","window","location","search","URLSearchParams","get","$efff59cb340ffb8f$var$getParam","product","amount","mainImage","createElement","images","length","$efff59cb340ffb8f$var$createGallery","src","className","id","appendChild","productButtonCart","some","productCart","innerHTML","name","category","review","$7Jg0N","currencyFormat","price","description","productCartButton","querySelector","addEventListener","e","push","addProductToCart","$1ZESu","createFirebaseCart","db","uid","setAttribute","innerText","$efff59cb340ffb8f$var$renderProduct","$dKLxC","getProduct","main","gallery","forEach","image","target","tagName","currentSrc"],"version":3,"file":"product.e3ea5368.js.map"}