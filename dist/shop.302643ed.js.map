{"mappings":"oeAAA,IAAAA,EAAAC,EAAA,sBCAAC,EAAAD,EAAA,uCDOA,MAAME,EAAiBC,SAASC,eAAe,YACzCC,EAAiBF,SAASC,eAAe,YACzCE,EAAmBH,SAASC,eAAe,SAC3CG,EAAoBJ,SAASC,eAAe,gBAElD,IAAII,EACAC,EAAW,GACXC,EAAO,GAEXC,eAAeC,IACX,MAAMC,QCfVF,eAA2BG,GACvB,MAAMC,EAAgBd,EAAAe,WAAWF,EAAI,YACrC,IACI,MALRG,KAKgBA,SAAgBhB,EAAAiB,QAAQH,GAOhC,OANiBE,EAAKE,KAAKC,IAChB,IACAA,EAAIC,OACPC,GAAIF,EAAIE,OAIlB,MAAMC,GACJC,QAAQC,IAAIF,IDGeG,CAAY3B,EAAAe,IAC3CZ,EAAeyB,UAAY,GAC3Bd,EAAiBe,SAAQC,IACrBC,EAAcD,MAGlBpB,EAAWI,EAGf,SAASiB,EAAcC,GACnB,MAAMF,EAAU1B,SAAS6B,cAAc,KACvCH,EAAQI,UAAY,UAEpBJ,EAAQK,aAAa,OAAQ,qBAAqBH,EAAKT,MAEvD,MAAMa,EAAaJ,EAAKK,OAASL,EAAKK,OAAO,GAAK,8EAI5CC,EAFuB3B,EAAK4B,MAAMC,GAAgBA,EAAYjB,KAAOS,EAAKT,KAGhF,mEAAkE,2DAGjEO,EAAOF,UAAY,mBAWpBQ,4GAImCJ,EAAAS,oDACXT,EAAAU,0DAEJV,EAAAW,mDAChBC,EAAAC,eAAAb,EAAAc,wBAEAR,wBAODS,YAAAjB,GACN,MAAAkB,EAAAlB,EAAAmB,cAAA,kBAEDD,EAASE,iBAAQ,SAAEtC,MAAAY,IACfA,EAAM2B,iBACNxC,EAAiByC,KAAApB,GACjBY,EAAMS,iBAAiB1C,GAEnBF,SAAsB6C,EAAAC,mBAAAvD,EAAAe,GAAAN,EAAA+C,IAAA7C,GAEtBqC,EAAkBb,aAClB,YAAmB,GAA+Da,EAAAS,UAAA,+BAMZC,IAG1E,MAAIC,EAAarD,EACMsD,MAAmDC,EAAAtD,EAAAqD,MAGvEE,EAAmBtD,EACCoD,MAAmD,IAACG,EAAA,GAGrDA,EAAL,KAAdJ,EACCjD,EAA6CsD,QAAQlC,GAAWA,EAAMW,WAAAkB,IAG1EjD,EACiB,QAAjBmD,IAAwBE,EAAYA,EAAAE,MAAA,CAAAC,EAAAC,IAAAA,EAAArB,MAAAoB,EAAApB,SAEjC,SAAAe,IAAAE,EAAAA,EAAAE,MAAA,CAAAC,EAAAC,IAAAD,EAAApB,MAAAqB,EAAArB,SAIP,OAAAgB,IAAAC,EAAeA,EAAgCE,MAAA,CAAAC,EAAAC,IAAAA,EAAAxB,OAAAuB,EAAAvB,UAE5C,OAAAmB,IAAAC,EAAAA,EAAAE,MAAA,CAAAC,EAAAC,IAAAD,EAAAvB,OAAAwB,EAAAxB,UAGCxC,EAAWyB,UAAA,GACZmC,EAAAlC,SAAAC,IAEHC,EAAkBD,MAIlBxB,EAAA4C,iBAAA,UAAmB1B,IACfkC,SAEER,iBAAA,UAAA1B,aAGM0B,iBAAA,UAAA1B,aASP4C,mBAAApE,EAAAqE,MAAAzD,MAAA0D","sources":["scripts/shop.js","scripts/products.js"],"sourcesContent":["import { db, auth } from \"./app\";\r\nimport { onAuthStateChanged } from \"firebase/auth\";\r\nimport { getProducts } from \"./products\";\r\nimport { createFirebaseCart, getFirebaseCart  } from \"./cart\";\r\nimport { getMyLocalCart, addProductToCart, currencyFormat } from \"./utils\";\r\n\r\n\r\nconst productSection = document.getElementById(\"products\");\r\nconst categoryFilter = document.getElementById(\"category\");\r\nconst orderFilterPrice = document.getElementById(\"order\");\r\nconst orderFilterReview = document.getElementById(\"order-review\");\r\n\r\nlet userLogged = undefined;\r\nlet products = [];\r\nlet cart = [];\r\n\r\nasync function loadProducts() {\r\n    const firebaseProducts = await getProducts(db);\r\n    productSection.innerHTML = \"\";\r\n    firebaseProducts.forEach(product => {\r\n        renderProduct(product);\r\n    });\r\n\r\n    products = firebaseProducts;\r\n}\r\n\r\nfunction renderProduct(item) {\r\n    const product = document.createElement(\"a\");\r\n    product.className = \"product\";\r\n\r\n    product.setAttribute(\"href\", `./product.html?id=${item.id}`);\r\n\r\n    const coverImage = item.images ? item.images[0] : \"https://cdn1.iconfinder.com/data/icons/business-company-1/500/image-512.png\";\r\n\r\n    const isProductAddedToCart = cart.some((productCart) => productCart.id === item.id);\r\n\r\n    const productButtonCart = isProductAddedToCart ?\r\n    '<button class=\"product__cart\" disabled>Producto añadido</button>' :\r\n    '<button class=\"product__cart\">Añadir al carrito</button>';\r\n\r\n    product.innerHTML = `\r\n    <img src=\"${coverImage}\" alt=\"\" class=\"product__image\">\r\n    <div class=\"product__info\">\r\n        <p class=\"product__category\">${item.category}</p> \r\n        <h2 class=\"product__name\">${item.name}</h2>\r\n        <p class=\"product__review\"> Review: ${item.review}</p> \r\n        <h3 class=\"product__price\">${currencyFormat(item.price)}</h3>\r\n        ${productButtonCart}\r\n    </div>\r\n    `;\r\n\r\n    productSection.appendChild(product);\r\n\r\n    const productCartButton = product.querySelector(\".product__cart\");\r\n\r\n    productCartButton.addEventListener(\"click\", async (e) => {\r\n        e.preventDefault(); // evitar que al dar click en el boton, funcione el enlace del padre.\r\n\r\n        cart.push(item);\r\n        addProductToCart(cart);\r\n\r\n        if (userLogged) {\r\n            await createFirebaseCart(db, userLogged.uid, cart);\r\n        }\r\n\r\n        productCartButton.setAttribute(\"disabled\", true);\r\n        productCartButton.innerText = \"Producto añadido\";\r\n\r\n    });\r\n}\r\n\r\nfunction filterBy(){\r\n    const newCategory = categoryFilter.value;\r\n    const newOrder = orderFilterPrice.value;\r\n    const newOrderReview = orderFilterReview.value;\r\n\r\n    let filteredProducts = [];\r\n\r\n    if (newCategory !== \"\") {\r\n        filteredProducts = products.filter((product) => product.category === newCategory);\r\n    } else {\r\n        filteredProducts = products;\r\n    }\r\n\r\n    if (newOrder === \"asc\") {\r\n        filteredProducts = filteredProducts.sort((a, b) => b.price - a.price);\r\n    }\r\n\r\n    if (newOrder === \"desc\") {\r\n        filteredProducts = filteredProducts.sort((a, b) => a.price - b.price);\r\n    }\r\n\r\n    if(newOrderReview === \"mp\") {\r\n        filteredProducts = filteredProducts.sort((a, b) => b.review - a.review)\r\n    }\r\n\r\n    if(newOrderReview === \"lp\") {\r\n        filteredProducts = filteredProducts.sort((a, b) => a.review - b.review);\r\n    }\r\n    \r\n    productSection.innerHTML = \"\";\r\n    filteredProducts.forEach(product => {\r\n        renderProduct(product);\r\n    });\r\n\r\n}\r\n\r\ncategoryFilter.addEventListener(\"change\", e => {\r\n    filterBy();\r\n});\r\n\r\norderFilterPrice.addEventListener(\"change\", e => {\r\n    filterBy();\r\n});\r\n\r\norderFilterReview.addEventListener(\"change\", e => {\r\n    filterBy();\r\n})\r\n\r\nonAuthStateChanged(auth, async (user) => {\r\n    if (user) {\r\n      // User is signed in, see docs for a list of available properties\r\n      // https://firebase.google.com/docs/reference/js/firebase.User\r\n      userLogged = user;\r\n      cart = await getFirebaseCart(db, userLogged.uid);\r\n      // ...\r\n    } else {\r\n        cart = getMyLocalCart();\r\n      // User is signed out\r\n      // ...\r\n    }\r\n\r\n    loadProducts();\r\n\r\n  });\r\n\r\n","import { collection, getDocs } from \"firebase/firestore\";\r\n\r\nasync function getProducts(db) {\r\n    const collectionRef = collection(db, \"products\");\r\n    try {\r\n        const { docs } =  await getDocs(collectionRef);\r\n        const products = docs.map((doc) => {\r\n            return {\r\n                ...doc.data(),\r\n                id: doc.id,\r\n            };\r\n        });\r\n        return products;\r\n    } catch(e) {\r\n        console.log(e);\r\n    }\r\n}\r\n\r\nexport {\r\n    getProducts,\r\n}"],"names":["$2mFfu","parcelRequire","$etBjH","$1edec348a320de1d$var$productSection","document","getElementById","$1edec348a320de1d$var$categoryFilter","$1edec348a320de1d$var$orderFilterPrice","$1edec348a320de1d$var$orderFilterReview","$1edec348a320de1d$var$userLogged","$1edec348a320de1d$var$products","$1edec348a320de1d$var$cart","async","$1edec348a320de1d$var$loadProducts","firebaseProducts","db","collectionRef","collection","docs","getDocs","map","doc","data","id","e","console","log","$5b188fdba1a03279$export$68a801b7b3c0bfaa","innerHTML","forEach","product","$1edec348a320de1d$var$renderProduct","item","createElement","className","setAttribute","coverImage","images","productButtonCart","some","productCart","category","name","review","$7Jg0N","currencyFormat","price","appendChild","productCartButton","querySelector","addEventListener","preventDefault","push","addProductToCart","$1ZESu","createFirebaseCart","uid","innerText","$1edec348a320de1d$var$filterBy","newCategory","value","newOrder","newOrderReview","filteredProducts","filter","sort","a","b","onAuthStateChanged","auth","user"],"version":3,"file":"shop.302643ed.js.map"}